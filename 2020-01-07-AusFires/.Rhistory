library(plyr)
library(tidyverse)
library(lubridate)
rm(list = ls())
library(plyr)
library(tidyverse)
library(lubridate)
rainfall <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-07/rainfall.csv')
temperature <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-07/temperature.csv')
name_sub <- function(data) {
name.list <- c()
for (i in unique(data$city_name)) {
name.list <- c(name.list, i)
}
return(name.list)
}
name_sub(temperature)[1]
temperature <- temperature %>%
mutate(date = as.Date(date, format = "%y/%m/%d")) %>%
filter(!is.na(temperature))
?as.POSIXlt
perth <- temperature  %>%
filter(city_name=="PERTH") %>%
filter(temp_type=="max") %>%
mutate(year=lubridate::year(date)) %>%
mutate(month_simple=lubridate::month(date)) %>%
select(city_name, date, year, month_simple, temperature) %>%
#mutate(year=floor_date(date, "year")) %>%
group_by(month=floor_date(date, "month")) %>%
mutate(avg_mon_temp=mean(temperature)) %>%
ungroup()
perth <- perth[!duplicated(perth['month']),]
x<- seq(1910, 2019, by = 10)
for (year in x){
perth$decade[perth$year  >= year  & perth$year < (year+10)] <- year
}
#calculate average temperature per month by decade
#split by decade
#average temperature by the month
mean.temp.month <- function(x) {
x %>%
group_by(month_simple) %>%
summarise(avg_mon_temp_dec=mean(temperature))
}
#works as well
#test <- perth %>%
#  split(., .$decade) %>%
#  sapply(., mean.temp.month)
perth <- round(ddply(perth, .(decade), mean.temp.month),2)
unlist(perth)
perth$decade <- factor(perth$decade)
perth %>%
filter(decade==1910| decade==2010) %>%
ggplot(., aes(x=month_simple, y=avg_mon_temp_dec, colour=decade)) +
geom_line() + geom_point()
perth$decade <- factor(perth$decade)
perth %>%
filter(month_simple==1) %>%
ggplot(., aes(x=month_simple, y=avg_mon_temp_dec, colour=decade)) +
geom_line() + geom_point(size=5) +
facet_wrap(~month_simple)
perth %>%
ggplot(., aes(month_simple, avg_mon_temp_dec)) +
geom_area(colour = "black", fill="blue",alpha=.9) +
facet_wrap(~decade)
library(ggridges)
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
ggplot(., aes(avg_mon_temp_dec, decade, group=decade, fill=..x..)) +
geom_density_ridges_gradient(scale=5, alpha = 0.5)
perth %>%
#mutate(decade = factor(decade),
#                  decade = factor(decade, levels = rev(levels(decade)))) %>%
ggplot(., aes(avg_mon_temp_dec, month_simple, group=month_simple, fill=..x..)) +
geom_density_ridges_gradient(scale=5, alpha = 0.5)
perth %>%
#mutate(decade = factor(decade),
#              decade = factor(decade, levels = rev(levels(decade)))) %>%
ggplot(., aes(month_simple, avg_mon_temp_dec, fill=decade, group=decade)) +
geom_area()
perth %>%
#mutate(decade = factor(decade),
#              decade = factor(decade, levels = rev(levels(decade)))) %>%
ggplot(., aes(avg_mon_temp_dec, fill=decade, group=decade)) +
geom_bar(stat ="bin")
perth %>%
#mutate(decade = factor(decade),
#              decade = factor(decade, levels = rev(levels(decade)))) %>%
ggplot(., aes(avg_mon_temp_dec, fill=decade, group=decade)) +
geom_area(stat ="bin")
perth %>%
filter(decade==1920 | decade==1950 | decade==1980 | decade==2010) %>%
ggplot(., aes(avg_mon_temp_dec, fill=decade, group=decade)) +
geom_area(stat ="bin")
perth %>%
ggplot(., aes(month_simple, avg_mon_temp_dec, fill=decade)) +
geom_area(position = "fill")
perth %>%
mutate(n = seq.int(nrow(.))) %>%
ggplot(., aes(n, avg_mon_temp_dec, fill=decade, group=decade)) +
geom_area()
perth %>%
filter(decade==1910 | decade==1940 | decade==1980 |decade==2010) %>%
mutate(n = seq.int(nrow(.))) %>%
ggplot(., aes(n, avg_mon_temp_dec, fill=decade, group=decade)) +
geom_area()
perth %>%
filter(decade==1910 | decade==1940 | decade==1980 |decade==2010) %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
mutate(n = seq.int(nrow(.))) %>%
ggplot(., aes(avg_mon_temp_dec, decade, group=decade, fill=..x..)) +
geom_density_ridges_gradient(scale=5, alpha = 0.5)
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
ggplot(., aes(avg_mon_temp_dec, decade, group=decade, fill=..x..)) +
geom_density_ridges_gradient(scale=5, alpha = 0.5)
perth %>%
mutate(n = seq.int(nrow(.))) %>%
ggplot(., aes(month_simple, avg_mon_temp_dec, group=decade, col=month_simple)) +
geom_line()
ylim(10,35)
clean_df <- temperature  %>%
filter(temp_type=="max") %>%
mutate(year=lubridate::year(date)) %>%
mutate(month_simple=lubridate::month(date)) %>%
select(city_name, date, year, month_simple, temperature) %>%
group_by(month=floor_date(date, "month")) %>%
mutate(avg_mon_temp=mean(temperature)) %>%
ungroup()
clean_df <-
clean_df %>%
group_by(city_name) %>%
distinct(., month, .keep_all = TRUE) %>%
ungroup() %>%
na.omit(.)
x<- seq(1910, 2019, by = 10)
for (year in x){
clean_df$decade[clean_df$year  >= year  & clean_df$year < (year+10)] <- year
}
#calculate average temperature per month by decade
#split by decade
#average temperature by the month
mean.temp.month <- function(x) {
x %>%
group_by(month_simple) %>%
summarise(avg_mon_temp_dec=mean(temperature))
}
#works as well
#test <- perth %>%
#  split(., .$decade) %>%
#  sapply(., mean.temp.month)
ddply(clean_df, .(decade), mean.temp.month)
clean_df <- round(ddply(clean_df, .(decade), mean.temp.month),2)
unlist(clean_df)
clean_df$decade <- factor(clean_df$decade)
clean_df %>%
filter(decade==1910| decade==2010) %>%
ggplot(., aes(x=month_simple, y=avg_mon_temp_dec, colour=decade)) +
geom_line() + geom_point()
clean_df %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
ggplot(., aes(avg_mon_temp_dec, decade, group=decade, fill=..x..)) +
geom_density_ridges_gradient(scale=5, alpha = 0.5)
clean_df %>%
#mutate(decade = factor(decade),
#              decade = factor(decade, levels = rev(levels(decade)))) %>%
ggplot(., aes(month_simple, avg_mon_temp_dec, fill=decade, group=decade)) +
geom_area()
temp_change_fun <- function(data) {
check <- data$Year-1
lead_var <- lag(data$avg_mon_temp_dec, 12)
data$next.growth = lead_var
return(data)
}
perth <- temp_change_fun(perth)
perth %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
filter(month_simple==10) %>%
filter(!decade==1910) %>%
ggplot(., aes(decade, temp_diff, group=1)) + geom_line()+
geom_hline(yintercept = 0) +
geom_ribbon(aes(ymin = 0, ymax = ..y..), position = "identity")
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
filter(decade==1920 | decade==1950 | decade==1980 | decade==2010) %>%
ggplot(., aes(x=temp_diff, y=decade, group=decade)) + geom_line()+
geom_hline(yintercept = 0) +
geom_density_ridges(scale=4)
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
filter(!decade==1910) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
ggplot(., aes(x=temp_diff, y=decade, group=decade, fill=decade)) + geom_line()+
geom_hline(yintercept = 0) +
geom_density_ridges(scale=4)
library(RColorBrewer)
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
filter(!decade==1910) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
ggplot(., aes(x=temp_diff, y=decade, group=decade, fill=..x..)) +
scale_fill_gradient(low = "red", high = "white") +     ##IX COLOR
geom_line()+
geom_hline(yintercept = 0) +
geom_density_ridges_gradient(scale=4)
temp_change_fun <- function(data) {
lead_var <- lag(data$avg_mon_temp_dec, 12)
data$next.growth = lead_var
return(data)
}
perth %>%
filter(decade==1910 | decade==2010) %>%
temp_change_fun(.) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
mutate(n = seq.int(nrow(.)))
perth <- temp_change_fun(perth)
perth %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth)
ggplot(perth,)
typeof(temperature$date)
ggplot(perth, aes(month, avg_mon_temp)) +
geom_line(aes(y = avg_mon_temp)) #+
ggplot(perth, aes(date, temperature)) +
geom_line(aes(y = temperature, colour = "temperature")) +
geom_line(aes(y = var1, colour = "var1"))
ggplot(perth, aes(date, temperature)) +
geom_line(aes(y = temperature, colour = "temperature")) +
geom_line(aes(y = var1, colour = "var1"))
perth %>%
ggplot(aes(x = month, y = avg_mon_temp)) +
geom_point(color = "darkorchid4") +
labs(title = "Precipitation - Boulder, Colorado",
subtitle = "The data frame is sent to the plot using pipes",
y = "Daily precipitation (inches)",
x = "Date") + theme_bw(base_size = 15)
ggplot(perth, aes(month, avg_mon_temp)) +
geom_line(aes(y = avg_mon_temp)) #+
ggplot(perth, aes(month, avg_mon_temp_dec)) +
geom_line(aes(y = avg_mon_temp_dec)) #+
ggplot(perth, aes(month, avg_mon_temp_dec))
perth %>%
ggplot(aes(x = month, y = avg_mon_temp_dec)) +
geom_point(color = "darkorchid4") +
labs(title = "Precipitation - Boulder, Colorado",
subtitle = "The data frame is sent to the plot using pipes",
y = "Daily precipitation (inches)",
x = "Date") + theme_bw(base_size = 15)
ggplot(perth, aes(x=month)) +
geom_area(aes(y=avg_mon_temp, fill="avg_mon_temp")) +
#geom_area(aes(y=uempmed, fill="uempmed")) +
labs(title="Area Chart of Returns Percentage",
subtitle="From Wide Data format",
caption="Source: Economics",
y="Returns %")
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
filter(!decade==1910) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
ggplot(., aes(x=temp_diff, y=decade, group=decade, fill=..x..)) +
scale_fill_gradient(low = "red", high = "white", midpoint = 0) +     ##IX COLOR
geom_line()+
geom_hline(yintercept = 0) +
geom_density_ridges_gradient(scale=4)
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
filter(!decade==1910) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
ggplot(., aes(x=temp_diff, y=decade, group=decade, fill=..x..)) +
#scale_fill_gradient(low = "red", high = "white") +
scale_colour_gradient2(..., low = muted("red"), mid = "white",
high = muted("blue"), midpoint = 0, space = "Lab",
na.value = "grey50", guide = "colourbar", aesthetics = "fill") +
geom_line()+
geom_hline(yintercept = 0) +
geom_density_ridges_gradient(scale=4)
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
filter(!decade==1910) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
ggplot(., aes(x=temp_diff, y=decade, group=decade, fill=..x..)) +
#scale_fill_gradient(low = "red", high = "white") +
scale_colour_gradient2(low = muted("red"), mid = "white",
high = muted("blue"), midpoint = 0, space = "Lab",
na.value = "grey50", guide = "colourbar", aesthetics = "fill") +
geom_line()+
geom_hline(yintercept = 0) +
geom_density_ridges_gradient(scale=4)
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
filter(!decade==1910) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
ggplot(., aes(x=temp_diff, y=decade, group=decade, fill=..x..)) +
#scale_fill_gradient(low = "red", high = "white") +
scale_colour_gradient2(low = "red", mid = "white",
high = "blue", midpoint = 0, space = "Lab",
na.value = "grey50", guide = "colourbar", aesthetics = "fill") +
geom_line()+
geom_hline(yintercept = 0) +
geom_density_ridges_gradient(scale=4)
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
filter(!decade==1910) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
ggplot(., aes(x=temp_diff, y=decade, group=decade, fill=..x..)) +
scale_fill_gradient(low = "red", high = "white") +     ##IX COLOR
geom_line()+
geom_hline(yintercept = 0) +
geom_density_ridges_gradient(scale=4)
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
filter(!decade==1910) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
ggplot(., aes(x=temp_diff, y=decade, group=decade, fill=..x..)) +
#scale_fill_gradient(low = "red", high = "white") +
scale_colour_gradient2(low = "red", mid = "white",
high = "blue", midpoint = 0, space = "Lab",
na.value = "grey50", guide = "colourbar", aesthetics = "fill") +
geom_line()+
geom_hline(yintercept = 0) +
geom_density_ridges_gradient(scale=4)
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
filter(!decade==1910) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
ggplot(., aes(x=temp_diff, y=decade, group=decade, fill=..x..)) +
#scale_fill_gradient(low = "red", high = "white") +
scale_colour_gradient2(low = "red", mid = "white",
high = "blue", midpoint = 0, space = "Lab",
na.value = "grey50", guide = "colourbar", aesthetics = "fill") +
scale_colour_gradient2(low = "red", mid = "white",
high = "blue", midpoint = 0, space = "Lab",
na.value = "grey50", aesthetics = "fill") +
geom_line()+
geom_hline(yintercept = 0) +
geom_density_ridges_gradient(scale=4)
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
filter(!decade==1910) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
ggplot(., aes(x=temp_diff, y=decade, group=decade, fill=..x..)) +
#scale_fill_gradient(low = "red", high = "white") +
#scale_colour_gradient2(low = "red", mid = "white",
#      high = "blue", midpoint = 0, space = "Lab",
#      na.value = "grey50", guide = "colourbar", aesthetics = "fill") +
scale_colour_gradient2(low = "red", mid = "white",
high = "blue", midpoint = 0, space = "Lab",
na.value = "grey50", aesthetics = "fill") +
geom_line()+
geom_hline(yintercept = 0) +
geom_density_ridges_gradient(scale=4)
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
filter(!decade==1910) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
ggplot(., aes(x=temp_diff, y=decade, group=decade, fill=..x..)) +
scale_fill_gradient(low = "red", high = "white") +     ##FIX COLOR
geom_line()+
geom_hline(yintercept = 0) +
geom_density_ridges_gradient(scale=4)
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
filter(!decade==1910) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
ggplot(., aes(x=temp_diff, y=decade, group=decade, fill=..x..)) +
#scale_fill_gradient(low = "red", high = "white") +
scale_colour_gradient2(low = "red", mid = "white",
high = "blue", midpoint = 0, space = "Lab",
na.value = "grey50", guide = "colourbar", aesthetics = "fill") +
geom_line()+
geom_hline(yintercept = 0) +
geom_density_ridges_gradient(scale=4)
clean_df %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
filter(!decade==1910) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
ggplot(., aes(x=temp_diff, y=decade, group=decade, fill=..x..)) +
#scale_fill_gradient(low = "red", high = "white") +
scale_colour_gradient2(low = "red", mid = "white",
high = "blue", midpoint = 0, space = "Lab",
na.value = "grey50", guide = "colourbar", aesthetics = "fill") +
geom_line()+
geom_hline(yintercept = 0) +
geom_density_ridges_gradient(scale=4)
perth %>%
mutate(decade = factor(decade),
decade = factor(decade, levels = rev(levels(decade)))) %>%
filter(!decade==1910) %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
ggplot(., aes(x=temp_diff, y=decade, group=decade, fill=..x..)) +
#scale_fill_gradient(low = "red", high = "white") +
scale_colour_gradient2(low = "red", mid = "white",
high = "blue", midpoint = 0, space = "Lab",
na.value = "grey50", guide = "colourbar", aesthetics = "fill") +
geom_line()+
geom_hline(yintercept = 0) +
geom_density_ridges_gradient(scale=4)
perth %>%
mutate(temp_diff = avg_mon_temp_dec - next.growth) %>%
filter(month_simple==10) %>%
filter(!decade==1910) %>%
ggplot(., aes(decade, temp_diff, group=1)) + geom_line()+
geom_hline(yintercept = 0) +
geom_ribbon(aes(ymin = 0, ymax = ..y..), position = "identity")
clean_df
View(clean_df)
clean_df <- temperature  %>%
filter(temp_type=="max") %>%
mutate(year=lubridate::year(date)) %>%
mutate(month_simple=lubridate::month(date)) %>%
select(city_name, date, year, month_simple, temperature) %>%
group_by(month=floor_date(date, "month")) %>%
mutate(avg_mon_temp=mean(temperature)) %>%
ungroup()
clean_df <-
clean_df %>%
group_by(city_name) %>%
distinct(., month, .keep_all = TRUE) %>%
ungroup() %>%
na.omit(.)
x<- seq(1910, 2019, by = 10)
for (year in x){
clean_df$decade[clean_df$year  >= year  & clean_df$year < (year+10)] <- year
}
#calculate average temperature per month by decade
#split by decade
#average temperature by the month
mean.temp.month <- function(x) {
x %>%
group_by(month_simple) %>%
summarise(avg_mon_temp_dec=mean(temperature))
}
#works as well
#test <- perth %>%
#  split(., .$decade) %>%
#  sapply(., mean.temp.month)
ddply(clean_df, .(decade), mean.temp.month)
clean_df <- round(ddply(clean_df, .(decade), mean.temp.month),2)
unlist(clean_df)
temperature  %>%
filter(temp_type=="max") %>%
mutate(year=lubridate::year(date)) %>%
mutate(month_simple=lubridate::month(date)) %>%
select(city_name, date, year, month_simple, temperature) %>%
group_by(month=floor_date(date, "month")) %>%
mutate(avg_mon_temp=mean(temperature)) %>%
ungroup()
clean_df <- temperature  %>%
filter(temp_type=="max") %>%
mutate(year=lubridate::year(date)) %>%
mutate(month_simple=lubridate::month(date)) %>%
select(city_name, date, year, month_simple, temperature) %>%
group_by(month=floor_date(date, "month")) %>%
mutate(avg_mon_temp=mean(temperature)) %>%
ungroup()
clean_df %>%
group_by(city_name) %>%
distinct(., month, .keep_all = TRUE) %>%
ungroup() %>%
na.omit(.)
x<- seq(1910, 2019, by = 10)
for (year in x){
clean_df$decade[clean_df$year  >= year  & clean_df$year < (year+10)] <- year
}
clean_df
clean_df$decade <- factor(clean_df$decade)
clean_df %>%
filter(decade==1910| decade==2010) %>%
ggplot(., aes(x=month_simple, y=avg_mon_temp_dec, colour=decade)) +
geom_line() + geom_point()
clean_df
